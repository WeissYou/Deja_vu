C51 COMPILER V9.54   TASK                                                                  11/25/2018 07:39:08 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TASK
OBJECT MODULE PLACED IN Task.obj
COMPILER INVOKED BY: C:\Keil_v4\C51\BIN\C51.EXE Task\Task.c OPTIMIZE(3,SPEED) BROWSE INCDIR(.\ADC;.\Deja_vu;.\Global;.\i
                    -nterrupt;.\Main;.\Motor;.\PWM;.\Timer;.\USART;..\DC_motors;.\Task;.\Buzzer;.\LED) DEFINE(DEBUG) DEBUG OBJECTEXTEND PRINT
                    -(.\Task.lst) TABS(2) OBJECT(Task.obj)

line level    source

   1          /******************** (C) COPYRIGHT 2018 ЁбкуяТ **********************************
   2          * File Name          :  Task.c
   3          * Author             :  ЁбкуяТ
   4          * CPU Type           :  STC15
   5          * IDE                :  IAR 8.22.1
   6          * Version            :  V1.0
   7          * Date               :  24/11/2018
   8          * Description        :  хннЯ╢╕юМ
   9          *******************************************************************************/
  10          
  11          
  12          
  13          /* Includes ------------------------------------------------------------------*/
  14          #include "Global.h"
  15          #include "Task.h"
  16          #include "motor.h"
  17          #include "Motors_Break.h"
  18          #include "Deja_vu.h"
  19          #include "Buzzer.h"
  20          #include "stdio.h"
  21          
  22          /* Private variables ---------------------------------------------------------*/
  23          volatile unsigned char Task_Status = TASK_STATUS_STARTING_POINT_STANDBY;        // хннЯв╢л╛
  24          volatile unsigned int Task_Delay_Time_Cnt = 0;                                  // хннЯжп╣днчвХхШясй╠й╠╪Д╪
             -фйЩ
  25              
  26          volatile unsigned char tmp_flag=0;                                              // аый╠flag
  27          volatile unsigned char tmp_flag2 = 0;                                           // аый╠flag2
  28          /* Private function prototypes -----------------------------------------------*/
  29          
  30          
  31          /* Private functions ---------------------------------------------------------*/
  32          
  33          /*******************************************************************************
  34          *                           ЁбкуяТ@2018-11-24
  35          * Function Name  :  Task_Delay_Start
  36          * Description    :  хннЯясй╠©╙й╪
  37          * Input          :  None
  38          * Output         :  None
  39          * Return         :  None
  40          *******************************************************************************/
  41          void Task_Delay_Start(unsigned int time)
  42          {
  43   1          // иХжцясй╠й╠╪Д
  44   1          Task_Delay_Time_Cnt = time;
  45   1      }// End of void Task_Delay_Start(unsigned int time)
  46          
  47          
  48          /*******************************************************************************
  49          *                           ЁбкуяТ@2018-11-24
  50          * Function Name  :  Task_Delay_Is_Delay
  51          * Description    :  хннЯясй╠йг╥Я╢╕сзясй╠жп
  52          * Input          :  None
C51 COMPILER V9.54   TASK                                                                  11/25/2018 07:39:08 PAGE 2   

  53          * Output         :  None
  54          * Return         :  None
  55          *******************************************************************************/
  56          unsigned char Task_Delay_Is_Delay(void)
  57          {
  58   1          if (Task_Delay_Time_Cnt>0)return 1;
  59   1          return 0;
  60   1      }// End of unsigned char Task_Delay_Is_Delay(void)
  61          
  62          
  63          /*******************************************************************************
  64          *                           ЁбкуяТ@2018-11-24
  65          * Function Name  :  Task_Timer_Handle
  66          * Description    :  хннЯ╤╗й╠фВ╢╕юМ╨╞йЩ
  67          * Input          :  None
  68          * Output         :  None
  69          * Return         :  None
  70          *******************************************************************************/
  71          void Task_Timer_Handle(void)
  72          {
  73   1      
  74   1          // хГ╧ШхннЯясй╠й╠╪Д╪фйЩ╩╧спж╣,тРхннЯясй╠й╠╪Д╪фйЩ--
  75   1          if (Task_Delay_Time_Cnt>0)Task_Delay_Time_Cnt--;
  76   1      
  77   1        switch (Task_Status)
  78   1        {
  79   2          // ╣╠г╟╢╕сзфП╣Ц╢Щ╩Зв╢л╛
  80   2          case TASK_STATUS_STARTING_POINT_STANDBY:
  81   2          {
  82   3              // хГ╧Шя╟╪ё╢╚╦пфВсЖ╣╫х╚╨з
  83   3              if (Tracing_Get_Black_Spot_Number() >= TRACING_ALL_BLACK_SPOT_NUMBER)
  84   3              {
  85   4                  // ©╙й╪я╟╪ё╩Зжф
  86   4                  Tracing_Start();
  87   4                
  88   4                  // ╥ДцЫфВ╤лцЫ
  89   4                  Buzzer_Tweet(BUZZER_SHORT_TWEET_TIME);
  90   4      
  91   4                  // ясй╠©╙фТфДкШ╪Л╡Б╩Зжф
  92   4                  Task_Delay_Start(TASK_STARTING_POINT_DELAY_TIME);
  93   4            
  94   4      #ifdef DEBUG
  95   4                  //printf("уЩ╫ЬхКиоаогЬ\n");
  96   4      #endif    
  97   4                  // гп╩╩в╢л╛н╙уЩтз╫ЬхКиоаогЬ
  98   4                  Task_Status=TASK_STATUS_IN_LOADING_AREA;
  99   4              }
 100   3              else
 101   3              {
 102   4                  // хГ╧Ш╣╠фзя╟╪ё╢╚╦пфВ╡╩йгх╚╨з
 103   4                  // мёж╧я╟╪ё╩Зжф
 104   4                  Tracing_Stop();
 105   4              }
 106   3              break;
 107   3          }
 108   2      
 109   2          // ╣╠г╟п║Ё╣уЩтз╫ЬхКиоаогЬ
 110   2          case TASK_STATUS_IN_LOADING_AREA:
 111   2          {
 112   3              // хГ╧Шожтз╡╩тзTask Delayжп,к╣цВясй╠©╙фТфДкШ╪Л╡Б╣дуБ╦Жясй╠ря╬╜╧Щх╔
 113   3              if (Task_Delay_Is_Delay() == 0)
 114   3              {
C51 COMPILER V9.54   TASK                                                                  11/25/2018 07:39:08 PAGE 3   

 115   4                  // хГ╧Ш╪Л╡Б╣╫х╚╨з╣дй╝вжб╥©з(рРн╙й╝вжб╥©з╠х╫оп║,кЫрт╥е©М╪Л╡БлУ╪ЧпХр╙╣д╨з╣ЦйЩ),к╣цВсЖиоакиоаогЬи
             -офбг╟╣ддг╦Жп║й╝вжб╥©зграый╠╠Йж╬н╩ц╩спжцн╩(╣зр╩╢н╪Л╡Б╣╫й╝вжб╥©з)
 116   4                  if (tmp_flag ==0 && (Tracing_Get_Black_Spot_Number() >= TRACING_ALL_BLACK_SPOT_NUMBER-2))
 117   4                  {
 118   5                      // иХжцаый╠╠Йж╬н╩жцн╩
 119   5                      tmp_flag = 1;
 120   5                      // ╥ДцЫфВ╤лцЫ
 121   5                      Buzzer_Tweet(BUZZER_SHORT_TWEET_TIME);
 122   5      
 123   5                      // гЕ©уаый╠╠Йж╬н╩2
 124   5                      tmp_flag2 = 0;
 125   5                  }
 126   4      
 127   4                  // хГ╧ШсЖ╣╫акиоаогЬ╣зр╩╦ЖмёЁ╣н╩,грйг╣зр╩╢нсЖ╣╫
 128   4                  if (tmp_flag2==0 && SNR0 == 1 && SNR1 == 1)
 129   4                  {
 130   5                      // аый╠╠Йж╬н╩жцн╩
 131   5                      tmp_flag2 = 1;
 132   5      
 133   5                      // ╢сожтзфП╠МцВп║Ё╣ря╬╜тзиоаогЬф╫л╗иоак,п║Ё╣тк╤╞кы╤х╪У╟К
 134   5                      Tracing_Set_Speed_Half();
 135   5      
 136   5                      // ╥ДцЫфВ╤лцЫ
 137   5                      Buzzer_Tweet(BUZZER_SHORT_TWEET_TIME);
 138   5                    
 139   5                // мёж╧я╟╪ё╩Зжф
 140   5              Tracing_Stop();
 141   5                    
 142   5                      // ©╙й╪ткппп║Ё╣╣╧мкпчуЩ╩Зжф
 143   5                      Motors_Break_Start();
 144   5                    
 145   5                      // гп╩╩в╢л╛н╙╣╠г╟п║Ё╣╢╕сзиоаогЬ╣з1╦ЖмёЁ╣н╩
 146   5                      Task_Status = TASK_STATUS_LOADING_AREA_PARKING_SPACE_1;
 147   5      
 148   5                  }
 149   4              }
 150   3          else
 151   3          {
 152   4            // хГ╧Ш╩╧тзTask delayжп,к╣цВиор╩в╢л╛<<фП╣Ц╢Щ╩З>>жпвН╨СиХжц╣дdelayй╠╪Д╩╧ц╩╣╫
 153   4            // тзуБюОкЁ╠ЦЁУй╪╩╞р╩обаый╠╠Йж╬н╩
 154   4            tmp_flag=0;
 155   4          }
 156   3          break;
 157   3          }
 158   2          // ╣╠г╟п║Ё╣╢╕сзиоаогЬ╣з1╦ЖмёЁ╣н╩
 159   2          case TASK_STATUS_LOADING_AREA_PARKING_SPACE_1:
 160   2          {
 161   3              // хГ╧Шп║Ё╣╣╧мкпчуЩ╩Зжфря╬╜╟яп║Ё╣н╩жцпчуЩмЙЁи
 162   3              if (Motors_Break_Is_Ok())
 163   3              {
 164   4      #ifdef DEBUG
 165   4                  //printf("тзиоаогЬ1Ё╣н╩\n");
 166   4      #endif
 167   4                  // гп╩╩в╢л╛н╙╣╠г╟п║Ё╣╢╕сзиоаогЬ╣з1╦ЖмёЁ╣н╩иож╢пп╩Зп╣йж╡ывВ
 168   4                  Task_Status = TASK_STATUS_LOADING_AREA_PARKING_SPACE_1_WORKING;
 169   4      
 170   4                  // х╥╠ёаый╠╠Йж╬н╩ря╬╜╠╩гЕ©у
 171   4                  tmp_flag=0;
 172   4              }
 173   3      
 174   3              break;
 175   3          }
C51 COMPILER V9.54   TASK                                                                  11/25/2018 07:39:08 PAGE 4   

 176   2      
 177   2          // ╣╠г╟п║Ё╣╢╕сзиоаогЬ╣з1╦ЖмёЁ╣н╩иож╢пп╩Зп╣йж╡ывВ
 178   2          case TASK_STATUS_LOADING_AREA_PARKING_SPACE_1_WORKING:
 179   2          {
 180   3      
 181   3              // хГ╧Шйг╣зр╩╢нткпп╠╬в╢л╛,аый╠╠Йж╬н╩╩╧ц╩╠╩жцн╩
 182   3              if (tmp_flag == 0)
 183   3              {
 184   4                  // иХжцр╩╦ЖЁ╓й╠╪Д╣дdelayю╢дёдБв╔х║╡ывВ
 185   4                  Task_Delay_Start(200);
 186   4      
 187   4                  // ╥ДцЫфВ╤лцЫ
 188   4                  Buzzer_Tweet(BUZZER_SHORT_TWEET_TIME);
 189   4      
 190   4                  // аый╠╠Йж╬н╩жцн╩
 191   4                  tmp_flag = 1;
 192   4              }
 193   3              // тзуБюОвЖ╩Зп╣╠ш╣дв╔х║╡ывВ
 194   3              
 195   3      
 196   3      
 197   3              if(Task_Delay_Is_Delay()==0)//if (╩Зп╣╠ш╡ывВмЙ╠о)
 198   3              {
 199   4                  // х╥хо╡ывВмЙ╠о╨С©╙фТя╟╪ё╩Зжф
 200   4                  Tracing_Start();
 201   4      
 202   4                  // еп╤оожтзSNR0рт╪╟SNR1ря╬╜юК©╙╨зи╚(╡╩©и©©,пХр╙обцФ╪сdelay)
 203   4                  if (SNR0 == 0 && SNR1 == 0)
 204   4                  {
 205   5      
 206   5                      // ясй╠р╩╤╗й╠╪Д,х╥╠ёоб╢н╪Л╡БSNR0рт╪╟SNR1╣дй╠╨РЁ╣всря╬╜юК©╙╣з1╦ЖмёЁ╣н╩╣да╫╦ЖльуВп║╟Кй╝вжб╥©
             -з
 207   5                      Task_Delay_Start(TASK_OUT_PARKING_SPACE_SNR_CHECK_DELAY_TIME);
 208   5      #ifdef DEBUG
 209   5                      //printf("мЫиоаогЬ2Ё╣н╩\n");
 210   5      #endif
 211   5                      // гп╩╩в╢л╛н╙╣╠г╟п║Ё╣╢╕сзуЩтзг╟мЫиоаогЬ╣з2╦ЖмёЁ╣н╩╣дб╥ио
 212   5                      Task_Status = TASK_STATUS_GOING_LOADING_AREA_PARKING_SPACE_2;
 213   5      
 214   5                      // х╥╠ёаый╠╠Йж╬н╩ря╬╜╠╩гЕ©у
 215   5                      tmp_flag = 0;
 216   5                  }
 217   4              }
 218   3              break;
 219   3          }
 220   2          //╣╠г╟п║Ё╣╢╕сзуЩтзг╟мЫиоаогЬ╣з2╦ЖмёЁ╣н╩╣дб╥ио
 221   2          case TASK_STATUS_GOING_LOADING_AREA_PARKING_SPACE_2:
 222   2          {
 223   3              // хГ╧ШожтзSNRясй╠╪Л╡Б╣дDelayй╠╪Дря╬╜╧Щак
 224   3              if (Task_Delay_Is_Delay()==0)
 225   3              {
 226   4                  // хГ╧ШсЖиоиоаогЬ╣д╣з╤Ч╦ЖмёЁ╣н╩,грйг╣зр╩╢нсЖио
 227   4                  if (tmp_flag ==0 && SNR0 == 1 && SNR1 == 1)
 228   4                  {
 229   5                      // аый╠╠Йж╬н╩жцн╩
 230   5                      tmp_flag = 1;
 231   5      
 232   5                      // ╥ДцЫфВ╤лцЫ
 233   5                      Buzzer_Tweet(BUZZER_SHORT_TWEET_TIME);
 234   5      
 235   5                      // мёж╧я╟╪ё╩Зжф
 236   5                    Tracing_Stop();
C51 COMPILER V9.54   TASK                                                                  11/25/2018 07:39:08 PAGE 5   

 237   5                      
 238   5                      // ©╙й╪ткппп║Ё╣╣╧мкпчуЩ╩Зжф
 239   5                      Motors_Break_Start();
 240   5      #ifdef DEBUG
 241   5                      //printf("╢╕сзиоаогЬ2Ё╣н╩\n");
 242   5      #endif
 243   5                      // гп╩╩в╢л╛н╙╣╠г╟п║Ё╣╢╕сзиоаогЬ╣з2╦ЖмёЁ╣н╩
 244   5                      Task_Status = TASK_STATUS_LOADING_AREA_PARKING_SPACE_2;
 245   5      
 246   5                      // х╥╠ёаый╠╠Йж╬н╩ря╬╜╠╩гЕ©у
 247   5                      tmp_flag = 0;
 248   5                  }
 249   4              }
 250   3              else
 251   3              {
 252   4                  // ЁцSNRясй╠╪Л╡Бdelayй╠╪Д╩╧н╢╫АйЬ,гЕ©уа╫╦Жаый╠╠Йж╬н╩
 253   4                  tmp_flag = 0;
 254   4                  tmp_flag2 = 0;
 255   4              }
 256   3              break;
 257   3          }
 258   2      
 259   2          // ╣╠г╟п║Ё╣╢╕сзиоаогЬ╣з2╦ЖмёЁ╣н╩
 260   2          case TASK_STATUS_LOADING_AREA_PARKING_SPACE_2:
 261   2          {
 262   3              // хГ╧Шп║Ё╣╣╧мкпчуЩ╩Зжфря╬╜╟яп║Ё╣н╩жцпчуЩмЙЁи
 263   3              if (Motors_Break_Is_Ok())
 264   3              {
 265   4      
 266   4                  // гп╩╩в╢л╛н╙╣╠г╟п║Ё╣╢╕сзиоаогЬ╣з2╦ЖмёЁ╣н╩иож╢пп╩Зп╣йж╡ывВ
 267   4                  Task_Status = TASK_STATUS_LOADING_AREA_PARKING_SPACE_2_WORKING;
 268   4      
 269   4                  // х╥╠ёаый╠╠Йж╬н╩ря╬╜╠╩гЕ©у
 270   4                  tmp_flag = 0;
 271   4              }
 272   3      
 273   3              break;
 274   3          }
 275   2      
 276   2          // ╣╠г╟п║Ё╣╢╕сзиоаогЬ╣з2╦ЖмёЁ╣н╩иож╢пп╩Зп╣йж╡ывВ
 277   2          case TASK_STATUS_LOADING_AREA_PARKING_SPACE_2_WORKING:
 278   2          {
 279   3      
 280   3              // хГ╧Шйг╣зр╩╢нткпп╠╬в╢л╛,аый╠╠Йж╬н╩╩╧ц╩╠╩жцн╩
 281   3              if (tmp_flag == 0)
 282   3              {
 283   4                  // иХжцр╩╦ЖЁ╓й╠╪Д╣дdelayю╢дёдБв╔х║╡ывВ
 284   4                  Task_Delay_Start(200);
 285   4      
 286   4                  // ╥ДцЫфВ╤лцЫ
 287   4                  Buzzer_Tweet(BUZZER_SHORT_TWEET_TIME);
 288   4      
 289   4                  // аый╠╠Йж╬н╩жцн╩
 290   4                  tmp_flag = 1;
 291   4              }
 292   3      
 293   3      
 294   3      
 295   3              if (Task_Delay_Is_Delay() == 0)//if (╩Зп╣╠ш╡ывВмЙ╠о)
 296   3              {
 297   4                  // ╩ж╦╢я╟╪ё╣дкы╤хбЗкы
 298   4                  Tracing_Set_Speed_All();
C51 COMPILER V9.54   TASK                                                                  11/25/2018 07:39:08 PAGE 6   

 299   4                  
 300   4                  // х╥хо╡ывВмЙ╠о╨С©╙фТя╟╪ё╩Зжф
 301   4                  Tracing_Start();
 302   4      
 303   4                  // еп╤оожтзSNR0рт╪╟SNR1ря╬╜юК©╙╨зи╚(╡╩©и©©,пХр╙обцФ╪сdelay)
 304   4                  if (SNR0 == 0 && SNR1 == 0)
 305   4                  {
 306   5                      // ╥ДцЫфВ╤лцЫ
 307   5                      Buzzer_Tweet(BUZZER_SHORT_TWEET_TIME);
 308   5      
 309   5                      // ясй╠р╩╤╗й╠╪Д,х╥╠ёоб╢н╪Л╡Бй╝вжб╥©з╣дй╠╨Р╡╩╩АрРн╙обфбй╠Ё╣лЕвкл╛╡╩уЩ╤Ь╣╪жбнСй╤╠П
 310   5                      Task_Delay_Start(TASK_OUT_LOADING_AREA_CROSS_ROADS_CHECK_DELAY_TIME);
 311   5      #ifdef DEBUG
 312   5                      //printf("мкЁЖиоаогЬ\n");
 313   5      #endif
 314   5                      // гп╩╩в╢л╛н╙╣╠г╟п║Ё╣╢╕сзмкЁЖиоаогЬв╢л╛
 315   5                      Task_Status = TASK_STATUS_OUT_LOADING_AREA;
 316   5      
 317   5                      // х╥╠ёаый╠╠Йж╬н╩ря╬╜╠╩гЕ©у
 318   5                      tmp_flag = 0;
 319   5                  }
 320   4              }
 321   3              break;
 322   3          }
 323   2      
 324   2          // ╣╠г╟п║Ё╣╢╕сзмкЁЖиоаогЬв╢л╛
 325   2          case TASK_STATUS_OUT_LOADING_AREA:
 326   2          {
 327   3              /*
 328   3              // хГ╧Шожтзй╝вжб╥©зясй╠╪Л╡Б╣дDelayй╠╪Дря╬╜╧Щак
 329   3              if (Task_Delay_Is_Delay() == 0)
 330   3              {
 331   3                  // хГ╧Ш╪Л╡Б╣╫х╚╨з╣дй╝вжб╥©з,╤Ьгрйг╣зр╩╢н╪Л╡Б╣╫,к╣цВсЖиоак╠эуогЬг╟цФ╣ддг╦Ж╢Сй╝вжб╥©з
 332   3                  if (tmp_flag == 0 && Tracing_Get_Black_Spot_Number() >= TRACING_ALL_BLACK_SPOT_NUMBER)
 333   3                  {
 334   3                      tmp_flag = 1;
 335   3                  }
 336   3                  
 337   3                  // хГ╧Шж╝г╟╪Л╡Б╣╫╧Щй╝вжб╥©з,╤Ьожтз8б╥╩р╤х╢╚╦пфВя╧╣╫╣д╨з╣ЦйЩа©╨эиы
 338   3                  if (tmp_flag == 1 && Tracing_Get_Black_Spot_Number() <= TRACING_ALL_BLACK_SPOT_NUMBER-2)
 339   3                  {
 340   3                      printf("╫Ьуо╟╜гЬ\n");
 341   3      
 342   3                      // гп╩╩в╢л╛н╙╣╠г╟п║Ё╣╫ЬхКуо╟╜гЬ
 343   3                      Task_Status = TASK_STATUS_IN_OBSTACLE_AREA;
 344   3      
 345   3                      // гЕ©уаый╠╠Йж╬н╩
 346   3                      tmp_flag = 0;
 347   3      
 348   3                      // ╥ДцЫфВ╤лцЫ
 349   3                      Buzzer_Tweet(BUZZER_SHORT_TWEET_TIME);
 350   3                  }
 351   3              }
 352   3              else
 353   3              {
 354   3                  // хГ╧Шй╝вжб╥©зясй╠╪Л╡Бdelayй╠╪Д╩╧ц╩╫АйЬ
 355   3      
 356   3                  // ╟яа╫╦Жаый╠╠Йж╬н╩охгЕ╣Т
 357   3                  tmp_flag = 0;
 358   3                  tmp_flag2 = 0;
 359   3      
 360   3              }
C51 COMPILER V9.54   TASK                                                                  11/25/2018 07:39:08 PAGE 7   

 361   3              
 362   3              */
 363   3              break;
 364   3          }
 365   2      
 366   2          // п║Ё╣╫ЬхКуо╟╜гЬ
 367   2          case TASK_STATUS_IN_OBSTACLE_AREA:
 368   2          {
 369   3      
 370   3              break;
 371   3          }
 372   2      
 373   2        }
 374   1      }// End of void Task_Timer_Handle(void)
 375          
 376          
 377          /******************* (C) COPYRIGHT 2018 ЁбкуяТ *****END OF FILE******************/
 378          
 379          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    369    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
