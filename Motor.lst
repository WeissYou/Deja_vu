C51 COMPILER V9.54   MOTOR                                                                 11/24/2018 15:00:09 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MOTOR
OBJECT MODULE PLACED IN Motor.obj
COMPILER INVOKED BY: C:\Keil_v4\C51\BIN\C51.EXE Motor\Motor.c OPTIMIZE(2,SPEED) BROWSE INCDIR(.\ADC;.\Deja_vu;.\Global;.
                    -\interrupt;.\Main;.\Motor;.\PWM;.\Timer;.\USART;..\DC_motors) DEFINE(DEBUG) DEBUG OBJECTEXTEND PRINT(.\Motor.lst) TABS(2
                    -) OBJECT(Motor.obj)

line level    source

   1          /******************** (C) COPYRIGHT 2018 陈苏阳 **********************************
   2          * File Name          :  Motor.c
   3          * Author             :  陈苏阳
   4          * CPU Type           :  STC15
   5          * IDE                :  IAR 8.22.1
   6          * Version            :  V1.0
   7          * Date               :  24/11/2018
   8          * Description        :  
   9          *******************************************************************************/
  10          
  11          
  12          
  13          
  14          /* Includes ------------------------------------------------------------------*/
  15          #include"Global.h"
  16          #include<Motor.h>
  17          #include"PWM.h"
  18          
  19          /* Private variables ---------------------------------------------------------*/
  20          
  21          
  22          /* Private function prototypes -----------------------------------------------*/
  23          
  24          
  25          /* Private functions ---------------------------------------------------------*/
  26          
  27          
  28          /*******************************************************************************
  29          *                           陈苏阳@2018-11-24
  30          * Function Name  :  MotorL_setting_auto_dir
  31          * Description    :  设置左侧电机(自动判断方向)
  32          * Input          :  char speed          // 电机占空比,正数为前进,负数为后退
  33          * Output         :  None
  34          * Return         :  None
  35          *******************************************************************************/
  36          void MotorL_setting_auto_dir(char speed)       
  37          {
  38   1        uchar _speed;               // 速度临时变量
  39   1        if (speed < 0)
  40   1        {
  41   2          // 后退
  42   2          IN1 = 0;
  43   2          IN2 = 1;
  44   2          
  45   2          // 在此做一个-100的限制
  46   2          if (speed < -100)
  47   2          {
  48   3              _speed = 100;
  49   3          }
  50   2          else
  51   2          {
  52   3              // 从负数变为正数
  53   3              _speed = -speed;
C51 COMPILER V9.54   MOTOR                                                                 11/24/2018 15:00:09 PAGE 2   

  54   3          }
  55   2        }
  56   1        else
  57   1        {
  58   2          // 在此做一个100的限制
  59   2          if (speed > 100)
  60   2          {
  61   3                _speed = 100;
  62   3          }
  63   2          else
  64   2          {
  65   3              // 正数就直接赋值
  66   3              _speed = speed;
  67   3          }
  68   2      
  69   2          // 前进
  70   2          IN1 = 1;
  71   2          IN2 = 0;
  72   2        }
  73   1      
  74   1        // 改变speed取值（1~100）改变占空比
  75   1        pwmL_setting(_speed);    
  76   1        
  77   1      }// End of void MotorL_setting_auto_dir(char speed)      
  78          
  79          
  80          
  81           /*******************************************************************************
  82           *                           陈苏阳@2018-11-24
  83           * Function Name  :  MotorR_setting_auto_dir
  84           * Description    :  设置左侧电机(自动判断方向)
  85           * Input          :  char speed          // 电机占空比,正数为前进,负数为后退
  86           * Output         :  None
  87           * Return         :  None
  88           *******************************************************************************/
  89          void MotorR_setting_auto_dir(char speed)       
  90          {
  91   1          uchar _speed;               // 速度临时变量
  92   1          if (speed < 0)
  93   1          {
  94   2              // 后退
  95   2              IN3 = 0;
  96   2              IN4 = 1;
  97   2      
  98   2              // 在此做一个-100的限制
  99   2              if (speed < -100)
 100   2              {
 101   3                  _speed = 100;
 102   3              }
 103   2              else
 104   2              {
 105   3                  // 从负数变为正数
 106   3                  _speed = -speed;
 107   3              }
 108   2          }
 109   1          else
 110   1          {
 111   2              // 在此做一个100的限制
 112   2              if (speed > 100)
 113   2              {
 114   3                  _speed = 100;
 115   3              }
C51 COMPILER V9.54   MOTOR                                                                 11/24/2018 15:00:09 PAGE 3   

 116   2              else
 117   2              {
 118   3                  // 正数就直接赋值
 119   3                  _speed = speed;
 120   3              }
 121   2      
 122   2              // 前进
 123   2              IN3 = 1;
 124   2              IN4 = 0;
 125   2          }
 126   1          // 改变speed取值（1~100）改变占空比
 127   1          pwmR_setting(_speed);
 128   1      
 129   1      }// End of void MotorR_setting_auto_dir(char speed) 
 130          
 131          
 132          /*******************************************************************************
 133          *                           陈苏阳@2018-11-24
 134          * Function Name  :  Motors_stop
 135          * Description    :  停车
 136          * Input          :  None
 137          * Output         :  None
 138          * Return         :  None
 139          *******************************************************************************/
 140          void Motors_stop(void)
 141          {   
 142   1          // 设置占空比为0
 143   1          pwmR_setting(0);
 144   1          pwmL_setting(0);
 145   1          IN1 = 0;
 146   1          IN2 = 0;
 147   1          IN3 = 0;
 148   1          IN4 = 0;
 149   1      }// End of void Motors_stop(void)
 150          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    147    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
