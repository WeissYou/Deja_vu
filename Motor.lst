C51 COMPILER V9.54   MOTOR                                                                 11/25/2018 07:38:04 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MOTOR
OBJECT MODULE PLACED IN Motor.obj
COMPILER INVOKED BY: C:\Keil_v4\C51\BIN\C51.EXE Motor\Motor.c OPTIMIZE(3,SPEED) BROWSE INCDIR(.\ADC;.\Deja_vu;.\Global;.
                    -\interrupt;.\Main;.\Motor;.\PWM;.\Timer;.\USART;..\DC_motors;.\Task;.\Buzzer;.\LED) DEFINE(DEBUG) DEBUG OBJECTEXTEND PRI
                    -NT(.\Motor.lst) TABS(2) OBJECT(Motor.obj)

line level    source

   1          /******************** (C) COPYRIGHT 2018 陈苏阳 **********************************
   2          * File Name          :  Motor.c
   3          * Author             :  陈苏阳
   4          * CPU Type           :  STC15
   5          * IDE                :  IAR 8.22.1
   6          * Version            :  V1.0
   7          * Date               :  24/11/2018
   8          * Description        :  
   9          *******************************************************************************/
  10          
  11          
  12          
  13          
  14          /* Includes ------------------------------------------------------------------*/
  15          #include "Global.h"
  16          #include <Motor.h>
  17          #include "PWM.h"
  18          #include "stdio.h"
  19          
  20          /* Private variables ---------------------------------------------------------*/
  21          
  22          
  23          /* Private function prototypes -----------------------------------------------*/
  24          
  25          
  26          /* Private functions ---------------------------------------------------------*/
  27          
  28          
  29          /*******************************************************************************
  30          *                           陈苏阳@2018-11-24
  31          * Function Name  :  MotorL_setting_auto_dir
  32          * Description    :  设置左侧电机(自动判断方向)
  33          * Input          :  char speed          // 电机占空比,正数为前进,负数为后退
  34          * Output         :  None
  35          * Return         :  None
  36          *******************************************************************************/
  37          void MotorL_setting_auto_dir(char speed)       
  38          {
  39   1        uchar _speed;               // 速度临时变量 
  40   1        printf("L:%d\n",(int)speed);
  41   1        if (speed < 0)
  42   1        {
  43   2          // 后退
  44   2          IN1 = 0;
  45   2          IN2 = 1;
  46   2          
  47   2          // 在此做一个-100的限制
  48   2          if (speed < -100)
  49   2          {
  50   3              _speed = 100;
  51   3          }
  52   2          else
  53   2          {
C51 COMPILER V9.54   MOTOR                                                                 11/25/2018 07:38:04 PAGE 2   

  54   3              // 从负数变为正数
  55   3              _speed = -speed;
  56   3          }
  57   2        }
  58   1        else
  59   1        {
  60   2          // 在此做一个100的限制
  61   2          if (speed > 100)
  62   2          {
  63   3                _speed = 100;
  64   3          }
  65   2          else
  66   2          {
  67   3              // 正数就直接赋值
  68   3              _speed = speed;
  69   3          }
  70   2      
  71   2          // 前进
  72   2          IN1 = 1;
  73   2          IN2 = 0;
  74   2        }
  75   1      
  76   1        // 改变speed取值（1~100）改变占空比
  77   1        pwmL_setting(_speed);    
  78   1        
  79   1      }// End of void MotorL_setting_auto_dir(char speed)      
  80          
  81          
  82          
  83           /*******************************************************************************
  84           *                           陈苏阳@2018-11-24
  85           * Function Name  :  MotorR_setting_auto_dir
  86           * Description    :  设置左侧电机(自动判断方向)
  87           * Input          :  char speed          // 电机占空比,正数为前进,负数为后退
  88           * Output         :  None
  89           * Return         :  None
  90           *******************************************************************************/
  91          void MotorR_setting_auto_dir(char speed)       
  92          {
  93   1          uchar _speed;               // 速度临时变量
  94   1          printf("L:%d\n",(int)speed);
  95   1          if (speed < 0)
  96   1          {
  97   2              // 后退
  98   2              IN3 = 0;
  99   2              IN4 = 1;
 100   2      
 101   2              // 在此做一个-100的限制
 102   2              if (speed < -100)
 103   2              {
 104   3                  _speed = 100;
 105   3              }
 106   2              else
 107   2              {
 108   3                  // 从负数变为正数
 109   3                  _speed = -speed;
 110   3              }
 111   2          }
 112   1          else
 113   1          {
 114   2              // 在此做一个100的限制
 115   2              if (speed > 100)
C51 COMPILER V9.54   MOTOR                                                                 11/25/2018 07:38:04 PAGE 3   

 116   2              {
 117   3                  _speed = 100;
 118   3              }
 119   2              else
 120   2              {
 121   3                  // 正数就直接赋值
 122   3                  _speed = speed;
 123   3              }
 124   2      
 125   2              // 前进
 126   2              IN3 = 1;
 127   2              IN4 = 0;
 128   2          }
 129   1          // 改变speed取值（1~100）改变占空比
 130   1          pwmR_setting(_speed);
 131   1      
 132   1      }// End of void MotorR_setting_auto_dir(char speed) 
 133          
 134          
 135          /*******************************************************************************
 136          *                           陈苏阳@2018-11-24
 137          * Function Name  :  Motors_stop
 138          * Description    :  停车
 139          * Input          :  None
 140          * Output         :  None
 141          * Return         :  None
 142          *******************************************************************************/
 143          void Motors_stop(void)
 144          {   
 145   1          // 设置占空比为0
 146   1          pwmR_setting(0);
 147   1          pwmL_setting(0);
 148   1          IN1 = 0;
 149   1          IN2 = 0;
 150   1          IN3 = 0;
 151   1          IN4 = 0;
 152   1      }// End of void Motors_stop(void)
 153          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    181    ----
   CONSTANT SIZE    =      6    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
